function buildPayload(e,i){return{token:lessonPageEventsJsArgs.token,action:e,session_times:i,user_agent:navigator.userAgent}}function sendPayload(e,i){-1<LESSON_SESSION_COLLECTOR_GLOBALS.VALID_SEND_SESSION_ACTIONS.indexOf(e)&&LESSON_SESSION_COLLECTOR_GLOBALS.COLLECT_DATA&&(e=JSON.stringify(buildPayload(e,i)),navigator.sendBeacon(lessonPageEventsJsArgs.endpoint,e))}function UTCDatetime(e){return e=e.getTime(),new Date(e)}window.LESSON_SESSION_COLLECTOR_GLOBALS={VALID_SEND_SESSION_ACTIONS:["load","hidden","2hr"],STOP_ACTIONS:["hidden","passive","2hr"],COLLECT_DATA:lessonPageEventsJsArgs.collectData,TIMEOUT_2_HR_MS:72e5};var SessionTimesBuilder={mostRecentStart:null,sessionTimes:{},buildDatetime:function(e,i){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),i)},datetimeFloor:function(e){return this.buildDatetime(e,0)},datetimeCeiling:function(e){return this.buildDatetime(e,60)},buildKey:function(e){return this.datetimeFloor(e).toISOString()},initSessionTimes:function(e){var i=this;i.sessionTimes={},i.mostRecentStart=e,e=i.buildKey(e);return i.sessionTimes[e]=0,i.sessionTimes},bucketize:function(e){var i,t=this;if("load"===e.action)return t.initSessionTimes(e.datetime);if("visible"===e.action&&(t.mostRecentStart=e.datetime,i=t.buildKey(e.datetime),t.sessionTimes[i]=t.sessionTimes[i]||0),-1<LESSON_SESSION_COLLECTOR_GLOBALS.STOP_ACTIONS.indexOf(e.action)){if(null===t.mostRecentStart)return t.sessionTimes;var s=t.mostRecentStart;if(e.datetime<s)return t.sessionTimes;for(var n=t.buildKey(s),a=t.buildKey(e.datetime);n<a;){var o=t.datetimeCeiling(s);t.sessionTimes[n]=(t.sessionTimes[n]||0)+(o-s)/1e3,n=t.buildKey(s=o)}t.sessionTimes[n]=(t.sessionTimes[n]||0)+(e.datetime-s)/1e3,t.mostRecentStart=null}return t.sessionTimes}},sessionTimesBuilder=SessionTimesBuilder;navigator.sendBeacon&&(window.addEventListener("load",function(){var e={action:"load",datetime:UTCDatetime(new Date)},i=sessionTimesBuilder.bucketize(e);sendPayload(e.action,i),setTimeout(function(){var e={action:"2hr",datetime:UTCDatetime(new Date)},i=sessionTimesBuilder.bucketize(e);sendPayload(e.action,i),sessionTimesBuilder.initSessionTimes(e.datetime),LESSON_SESSION_COLLECTOR_GLOBALS.COLLECT_DATA=!1},LESSON_SESSION_COLLECTOR_GLOBALS.TIMEOUT_2_HR_MS)}),lifecycle.addEventListener("statechange",function(e){var i,t;LESSON_SESSION_COLLECTOR_GLOBALS.COLLECT_DATA&&(i=e.newState,e="passive"===(e=e.oldState)||"hidden"===e,"passive"===i&&(t={action:"passive",datetime:UTCDatetime(new Date)},sessionTimesBuilder.bucketize(t)),e&&"active"===i&&(t={action:"active",datetime:UTCDatetime(new Date)},sessionTimesBuilder.bucketize(t)),"hidden"===i)&&(t={action:"hidden",datetime:UTCDatetime(new Date)},e=sessionTimesBuilder.bucketize(t),sendPayload(t.action,e))}));